{"ast":null,"code":"import _asyncToGenerator from \"/home/angeloacr/Proyectos/loteriaNacional/app/loteriaNacionalFront/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { Component } from \"@angular/core\";\nlet MenuBoxComponent = class MenuBoxComponent {\n  constructor(actRoute, lottery, paymentService, cart, router) {\n    this.actRoute = actRoute;\n    this.lottery = lottery;\n    this.paymentService = paymentService;\n    this.cart = cart;\n    this.router = router;\n    this.linkLotto = \"\";\n    this.linkLoteriaNacional = \"\";\n    this.linkPozoMillonario = \"\";\n    this.linkMillonaria = \"\";\n    this.codigoPromocional = [];\n    this.confirmacionDeCompra = false;\n    this.compraFinalizada = false;\n    this.saldoInsuficiente = false;\n    this.compraCancelada = false;\n    this.isInstantaneas = false;\n    this.cancelMessage = \"\";\n    this.isError = false;\n    this.actRoute.params.subscribe(params => {\n      this.token = params[\"token\"];\n    });\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        _this.loadingMessage = \"Espera mientras procesamos tu informaci√≥n\";\n        _this.isLoading = true;\n\n        if (_this.token) {\n          let data = yield _this.lottery.authUser(_this.token);\n          _this.lotteryToken = data.lotteryToken;\n\n          if (_this.lotteryToken) {\n            _this.linkLoteriaNacional = `/compra_tus_juegos/loteria/${_this.token}`;\n            _this.linkLotto = `/compra_tus_juegos/lotto/${_this.token}`;\n            _this.linkPozoMillonario = `/compra_tus_juegos/pozo-millonario/${_this.token}`;\n            _this.linkMillonaria = `/compra_tus_juegos/millonaria/${_this.token}`;\n          }\n\n          yield _this.getCarritoTickets(); //this.getTotal();\n        }\n\n        _this.isLoading = false;\n      } catch (e) {\n        _this.isLoading = false;\n        console.log(e.message);\n        let errorMessage = e.message;\n        let errorTitle = \"Error\";\n\n        _this.openError(errorMessage, errorTitle);\n      }\n    })();\n  }\n\n  dismissCompras() {\n    this.confirmacionDeCompra = false;\n    this.isInstantaneas = false;\n    this.compraFinalizada = false;\n    this.saldoInsuficiente = false;\n    this.compraCancelada = false;\n  }\n\n  volver() {\n    this.dismissCompras();\n    this.router.navigateByUrl(`/compra_tus_juegos/${this.token}`);\n  }\n\n  getTotal() {\n    this.total = this.cart.getTotal();\n  }\n\n  comprar() {\n    this.dismissCompras();\n    let loteriaAux = this.ticketsLoteria;\n    let loteria = [];\n\n    for (let id in loteriaAux) {\n      let aux = {};\n      aux[\"combinacion1\"] = loteriaAux[id].ticket.combinacion;\n      aux[\"fracciones\"] = loteriaAux[id].ticket.seleccionados;\n      aux[\"subtotal\"] = parseFloat(loteriaAux[id].subtotal).toFixed(2);\n      aux[\"fecha\"] = loteriaAux[id].sorteo.fecha;\n      aux[\"sorteo\"] = loteriaAux[id].sorteo.sorteo;\n      loteria.push(aux);\n    }\n\n    let lottoAux = this.ticketsLotto;\n    let lotto = [];\n\n    for (let id in lottoAux) {\n      let aux = {};\n      aux[\"combinacion1\"] = lottoAux[id].ticket.combinacion1;\n      aux[\"combinacion2\"] = lottoAux[id].ticket.combinacion2;\n      aux[\"combinacion3\"] = lottoAux[id].ticket.combinacion3;\n      aux[\"combinacion4\"] = lottoAux[id].ticket.combinacion4;\n      aux[\"sorteo\"] = lottoAux[id].sorteo.sorteo;\n      aux[\"subtotal\"] = parseFloat(lottoAux[id].subtotal).toFixed(2);\n      aux[\"fecha\"] = lottoAux[id].sorteo.fecha;\n      lotto.push(aux);\n    }\n\n    let pozoAux = this.ticketsPozo;\n    let pozo = [];\n\n    for (let id in pozoAux) {\n      let aux = {};\n      aux[\"combinacion1\"] = pozoAux[id].ticket.combinacion1;\n      aux[\"combinacion2\"] = pozoAux[id].ticket.combinacion2;\n      aux[\"mascota\"] = pozoAux[id].ticket.mascota;\n      aux[\"sorteo\"] = pozoAux[id].sorteo.sorteo;\n      aux[\"subtotal\"] = parseFloat(pozoAux[id].subtotal).toFixed(2);\n      aux[\"fecha\"] = pozoAux[id].sorteo.fecha;\n      pozo.push(aux);\n    }\n\n    let millonariaAux = this.ticketsMillonaria;\n    let millonaria = [];\n\n    for (let id in millonariaAux) {\n      let aux = {};\n      aux[\"combinacion1\"] = millonariaAux[id].ticket.combinacion1;\n      aux[\"combinacion2\"] = millonariaAux[id].ticket.combinacion2;\n      aux[\"fracciones\"] = millonariaAux[id].ticket.seleccionados;\n      aux[\"subtotal\"] = parseFloat(millonariaAux[id].subtotal).toFixed(2);\n      aux[\"subtotalConDesc\"] = parseFloat(millonariaAux[id].subtotalConDesc).toFixed(2);\n      aux[\"tieneDescuento\"] = millonariaAux[id].tieneDescuento;\n      aux[\"fecha\"] = millonariaAux[id].sorteo.fecha;\n      aux[\"sorteo\"] = millonariaAux[id].sorteo.sorteo;\n      millonaria.push(aux);\n    }\n\n    let amount = parseFloat(this.paymentService.getTotal()).toFixed(2);\n    let amountConDesc = parseFloat(this.cart.getTotalConDesc()).toFixed(2);\n    this.detalleCompra = {\n      loteria,\n      millonaria,\n      lotto,\n      pozo,\n      amount,\n      amountConDesc\n    };\n    this.confirmacionDeCompra = true;\n  }\n\n  finalizarCompra() {\n    this.paymentService.finalizarCompra();\n    this.dismissCompras();\n    this.router.navigateByUrl(`/compra_tus_juegos/${this.token}`);\n  }\n\n  irARecarga() {}\n\n  confirmarCompra() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        _this2.isLoading = true;\n        _this2.loadingMessage = \"Espera mientras procesamos tu compra\";\n        let hasBalance = yield _this2.paymentService.hasBalance(0, _this2.token);\n\n        if (hasBalance) {\n          let reservaId = _this2.cart.getReservaId();\n\n          let cartValidation = yield _this2.cart.validarCarrito(reservaId);\n\n          if (cartValidation) {\n            let response = yield _this2.paymentService.confirmarCompra(_this2.token, reservaId);\n\n            if (response.status) {\n              _this2.codigoPromocional = response.codigoPromocional;\n\n              if (response.instantanea.status) {\n                _this2.dismissCompras();\n\n                _this2.instantaneas = response.instantanea.data;\n                _this2.isInstantaneas = true;\n              } else {\n                _this2.instantaneas = \"\";\n\n                _this2.abrirFinalizar();\n              }\n            } else {\n              _this2.cancelarCompra();\n            }\n          }\n\n          _this2.isLoading = false;\n        } else {\n          _this2.isLoading = false;\n          let message = \"Tu saldo es insuficiente para realizar la compra\";\n\n          _this2.recargarSaldo(message);\n        }\n      } catch (e) {\n        _this2.isLoading = false;\n        console.log(e.message);\n        let errorMessage = e.message;\n        let errorTitle = \"Error\";\n\n        _this2.openError(errorMessage, errorTitle);\n      }\n    })();\n  }\n\n  cancelarCompra() {\n    this.dismissCompras();\n    this.compraCancelada = true;\n  }\n\n  abrirFinalizar() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      _this3.dismissCompras();\n\n      yield _this3.cart.borrarCarrito();\n      _this3.compraFinalizada = true;\n    })();\n  }\n\n  recargarSaldo(message) {\n    this.recargaDeSaldoMessage = message;\n    this.dismissCompras();\n    this.saldoInsuficiente = true;\n  }\n\n  deleteMillonariaTicket(data) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        let identificador = data.ticket.identificador;\n        let fracciones = data.ticket.seleccionados;\n        _this4.loadingMessage = \"Removiendo boleto del carrito\";\n        _this4.isLoading = true;\n        let ticket = _this4.ticketsMillonaria[identificador].ticket;\n        let sorteo = data.sorteo;\n\n        let reservaId = _this4.lottery.getReservaId();\n\n        if (fracciones.length != 0) {\n          let response = yield _this4.lottery.eliminarBoletosDeReserva(_this4.token, ticket, sorteo, fracciones, 14, reservaId);\n        }\n\n        delete _this4.ticketsMillonaria[identificador];\n        yield _this4.cart.removeFromCart(ticket, 1);\n        yield _this4.cart.setCarritoMillonaria(_this4.ticketsMillonaria);\n        yield _this4.getCarritoTickets(); //this.getTotal();\n        //await this.setDescuento(14);\n\n        _this4.isLoading = false;\n      } catch (e) {\n        _this4.isLoading = false;\n        console.log(e.message);\n        let errorMessage = e.message;\n        let errorTitle = \"Error\";\n\n        _this4.openError(errorMessage, errorTitle);\n      }\n    })();\n  }\n\n  deleteLoteriaTicket(data) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        let identificador = data.ticket.identificador;\n        let fracciones = data.ticket.seleccionados;\n        _this5.loadingMessage = \"Removiendo boleto del carrito\";\n        _this5.isLoading = true;\n        let ticket = _this5.ticketsLoteria[identificador].ticket;\n        let sorteo = data.sorteo;\n\n        let reservaId = _this5.lottery.getReservaId();\n\n        if (fracciones.length != 0) {\n          let response = yield _this5.lottery.eliminarBoletosDeReserva(_this5.token, ticket, sorteo, fracciones, 1, reservaId);\n        }\n\n        delete _this5.ticketsLoteria[identificador];\n        yield _this5.cart.setCarritoLoteria(_this5.ticketsLoteria);\n        yield _this5.getCarritoTickets();\n\n        _this5.getTotal();\n\n        _this5.isLoading = false;\n      } catch (e) {\n        _this5.isLoading = false;\n        console.log(e.message);\n        let errorMessage = e.message;\n        let errorTitle = \"Error\";\n\n        _this5.openError(errorMessage, errorTitle);\n      }\n    })();\n  }\n\n  deleteLottoTicket(data) {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        let identificador = data.ticket.identificador;\n        let fraccion = \"\";\n        _this6.loadingMessage = \"Removiendo boleto del carrito\";\n        _this6.isLoading = true;\n        let ticket = _this6.ticketsLotto[identificador].ticket;\n        let sorteo = data.sorteo;\n\n        let reservaId = _this6.lottery.getReservaId();\n\n        let response = yield _this6.lottery.eliminarBoletosDeReserva(_this6.token, ticket, sorteo, fraccion, 2, reservaId);\n        delete _this6.ticketsLotto[identificador];\n        yield _this6.cart.setCarritoLotto(_this6.ticketsLotto);\n        yield _this6.getCarritoTickets();\n\n        _this6.getTotal();\n\n        _this6.isLoading = false;\n      } catch (e) {\n        _this6.isLoading = false;\n        console.log(e.message);\n        let errorMessage = e.message;\n        let errorTitle = \"Error\";\n\n        _this6.openError(errorMessage, errorTitle);\n      }\n    })();\n  }\n\n  deleteLoteriaFraccion(data) {\n    var _this7 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        _this7.loadingMessage = \"Removiendo boleto del carrito\";\n        _this7.isLoading = true;\n        let identificador = data.ticket.ticket.identificador;\n        let ticket = data.ticket.ticket;\n        let sorteo = data.ticket.sorteo;\n        let fraccion = data.fraccion;\n\n        let reservaId = _this7.cart.getReservaId();\n\n        let response = yield _this7.lottery.eliminarBoletosDeReserva(_this7.token, ticket, sorteo, [fraccion], 1, reservaId);\n\n        let index = _this7.ticketsLoteria[identificador].ticket.seleccionados.findIndex(x => x == fraccion);\n\n        _this7.ticketsLoteria[identificador].ticket.seleccionados.splice(index, 1);\n\n        if (_this7.ticketsLoteria[identificador].ticket.seleccionados.length == 0) {\n          delete _this7.ticketsLoteria[identificador];\n        }\n\n        yield _this7.cart.setCarritoLoteria(_this7.ticketsLoteria);\n        yield _this7.getCarritoTickets();\n\n        _this7.getTotal();\n\n        _this7.isLoading = false;\n      } catch (e) {\n        _this7.isLoading = false;\n        console.log(e.message);\n        let errorMessage = e.message;\n        let errorTitle = \"Error\";\n\n        _this7.openError(errorMessage, errorTitle);\n      }\n    })();\n  }\n\n  deletePozoTicket(data) {\n    var _this8 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        let identificador = data.ticket.identificador;\n        let fraccion = \"\";\n        _this8.loadingMessage = \"Removiendo boleto del carrito\";\n        _this8.isLoading = true;\n        let ticket = _this8.ticketsPozo[identificador].ticket;\n        let sorteo = data.sorteo;\n\n        let reservaId = _this8.lottery.getReservaId();\n\n        let response = yield _this8.lottery.eliminarBoletosDeReserva(_this8.token, ticket, sorteo, fraccion, 5, reservaId);\n        delete _this8.ticketsPozo[identificador];\n        yield _this8.cart.setCarritoPozo(_this8.ticketsPozo);\n        yield _this8.getCarritoTickets();\n\n        _this8.getTotal();\n\n        _this8.isLoading = false;\n      } catch (e) {\n        _this8.isLoading = false;\n        console.log(e.message);\n        let errorMessage = e.message;\n        let errorTitle = \"Error\";\n\n        _this8.openError(errorMessage, errorTitle);\n      }\n    })();\n  }\n\n  deleteAllTickets() {\n    var _this9 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        _this9.loadingMessage = \"Removiendo boletos del carrito\";\n        _this9.isLoading = true;\n        let boletosLoteria = Object.keys(_this9.ticketsLoteria).map(key => {\n          return {\n            ticket: _this9.ticketsLoteria[key].ticket,\n            sorteo: _this9.ticketsLoteria[key].sorteo\n          };\n        });\n        let boletosLotto = Object.keys(_this9.ticketsLotto).map(key => {\n          return {\n            ticket: _this9.ticketsLotto[key].ticket,\n            sorteo: _this9.ticketsLotto[key].sorteo\n          };\n        });\n        let boletosPozo = Object.keys(_this9.ticketsPozo).map(key => {\n          return {\n            ticket: _this9.ticketsPozo[key].ticket,\n            sorteo: _this9.ticketsPozo[key].sorteo\n          };\n        });\n\n        let reservaId = _this9.lottery.getReservaId();\n        /*       await this.lottery.eliminarTodosLosBoletosDeReserva(\n                this.token,\n                boletosLoteria,\n                boletosLotto,\n                boletosPozo,\n                reservaId\n              ); */\n\n\n        yield _this9.cart.borrarCarrito();\n        yield _this9.getCarritoTickets();\n\n        _this9.getTotal();\n\n        _this9.isLoading = false;\n      } catch (e) {\n        _this9.isLoading = false;\n        console.log(e.message);\n        let errorMessage = e.message;\n        let errorTitle = \"Error\";\n\n        _this9.openError(errorMessage, errorTitle);\n      }\n    })();\n  }\n\n  getCarritoTickets() {\n    var _this10 = this;\n\n    return _asyncToGenerator(function* () {\n      let carrito = yield _this10.cart.buscarCarrito();\n      _this10.ticketsLoteria = carrito.loteria;\n      _this10.ticketsLotto = carrito.lotto;\n      _this10.ticketsPozo = carrito.pozo;\n    })();\n  }\n\n  authError() {\n    this.openError(\"Por favor, para poder comprar tu boleto preferido, deber√°s iniciar sesi√≥n en tu cuenta\", \"Aviso\");\n  }\n\n  openError(msg, title) {\n    this.errorTitle = title.toUpperCase();\n    this.errorMessage = msg;\n    this.isError = true;\n  }\n\n  closeError() {\n    this.isError = false;\n  }\n\n};\nMenuBoxComponent = __decorate([Component({\n  selector: 'app-menu-box',\n  templateUrl: './menu-box.component.html',\n  styleUrls: ['./menu-box.component.scss']\n})], MenuBoxComponent);\nexport { MenuBoxComponent };","map":{"version":3,"sources":["/home/angeloacr/Proyectos/loteriaNacional/app/loteriaNacionalFront/src/app/ventas/components/menu-box/menu-box.component.ts"],"names":["__decorate","Component","MenuBoxComponent","constructor","actRoute","lottery","paymentService","cart","router","linkLotto","linkLoteriaNacional","linkPozoMillonario","linkMillonaria","codigoPromocional","confirmacionDeCompra","compraFinalizada","saldoInsuficiente","compraCancelada","isInstantaneas","cancelMessage","isError","params","subscribe","token","ngOnInit","loadingMessage","isLoading","data","authUser","lotteryToken","getCarritoTickets","e","console","log","message","errorMessage","errorTitle","openError","dismissCompras","volver","navigateByUrl","getTotal","total","comprar","loteriaAux","ticketsLoteria","loteria","id","aux","ticket","combinacion","seleccionados","parseFloat","subtotal","toFixed","sorteo","fecha","push","lottoAux","ticketsLotto","lotto","combinacion1","combinacion2","combinacion3","combinacion4","pozoAux","ticketsPozo","pozo","mascota","millonariaAux","ticketsMillonaria","millonaria","subtotalConDesc","tieneDescuento","amount","amountConDesc","getTotalConDesc","detalleCompra","finalizarCompra","irARecarga","confirmarCompra","hasBalance","reservaId","getReservaId","cartValidation","validarCarrito","response","status","instantanea","instantaneas","abrirFinalizar","cancelarCompra","recargarSaldo","borrarCarrito","recargaDeSaldoMessage","deleteMillonariaTicket","identificador","fracciones","length","eliminarBoletosDeReserva","removeFromCart","setCarritoMillonaria","deleteLoteriaTicket","setCarritoLoteria","deleteLottoTicket","fraccion","setCarritoLotto","deleteLoteriaFraccion","index","findIndex","x","splice","deletePozoTicket","setCarritoPozo","deleteAllTickets","boletosLoteria","Object","keys","map","key","boletosLotto","boletosPozo","carrito","buscarCarrito","authError","msg","title","toUpperCase","closeError","selector","templateUrl","styleUrls"],"mappings":"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","sourcesContent":["import { __decorate } from \"tslib\";\nimport { Component } from \"@angular/core\";\nlet MenuBoxComponent = class MenuBoxComponent {\n    constructor(actRoute, lottery, paymentService, cart, router) {\n        this.actRoute = actRoute;\n        this.lottery = lottery;\n        this.paymentService = paymentService;\n        this.cart = cart;\n        this.router = router;\n        this.linkLotto = \"\";\n        this.linkLoteriaNacional = \"\";\n        this.linkPozoMillonario = \"\";\n        this.linkMillonaria = \"\";\n        this.codigoPromocional = [];\n        this.confirmacionDeCompra = false;\n        this.compraFinalizada = false;\n        this.saldoInsuficiente = false;\n        this.compraCancelada = false;\n        this.isInstantaneas = false;\n        this.cancelMessage = \"\";\n        this.isError = false;\n        this.actRoute.params.subscribe((params) => {\n            this.token = params[\"token\"];\n        });\n    }\n    async ngOnInit() {\n        try {\n            this.loadingMessage = \"Espera mientras procesamos tu informaci√≥n\";\n            this.isLoading = true;\n            if (this.token) {\n                let data = await this.lottery.authUser(this.token);\n                this.lotteryToken = data.lotteryToken;\n                if (this.lotteryToken) {\n                    this.linkLoteriaNacional = `/compra_tus_juegos/loteria/${this.token}`;\n                    this.linkLotto = `/compra_tus_juegos/lotto/${this.token}`;\n                    this.linkPozoMillonario = `/compra_tus_juegos/pozo-millonario/${this.token}`;\n                    this.linkMillonaria = `/compra_tus_juegos/millonaria/${this.token}`;\n                }\n                await this.getCarritoTickets();\n                //this.getTotal();\n            }\n            this.isLoading = false;\n        }\n        catch (e) {\n            this.isLoading = false;\n            console.log(e.message);\n            let errorMessage = e.message;\n            let errorTitle = \"Error\";\n            this.openError(errorMessage, errorTitle);\n        }\n    }\n    dismissCompras() {\n        this.confirmacionDeCompra = false;\n        this.isInstantaneas = false;\n        this.compraFinalizada = false;\n        this.saldoInsuficiente = false;\n        this.compraCancelada = false;\n    }\n    volver() {\n        this.dismissCompras();\n        this.router.navigateByUrl(`/compra_tus_juegos/${this.token}`);\n    }\n    getTotal() {\n        this.total = this.cart.getTotal();\n    }\n    comprar() {\n        this.dismissCompras();\n        let loteriaAux = this.ticketsLoteria;\n        let loteria = [];\n        for (let id in loteriaAux) {\n            let aux = {};\n            aux[\"combinacion1\"] = loteriaAux[id].ticket.combinacion;\n            aux[\"fracciones\"] = loteriaAux[id].ticket.seleccionados;\n            aux[\"subtotal\"] = parseFloat(loteriaAux[id].subtotal).toFixed(2);\n            aux[\"fecha\"] = loteriaAux[id].sorteo.fecha;\n            aux[\"sorteo\"] = loteriaAux[id].sorteo.sorteo;\n            loteria.push(aux);\n        }\n        let lottoAux = this.ticketsLotto;\n        let lotto = [];\n        for (let id in lottoAux) {\n            let aux = {};\n            aux[\"combinacion1\"] = lottoAux[id].ticket.combinacion1;\n            aux[\"combinacion2\"] = lottoAux[id].ticket.combinacion2;\n            aux[\"combinacion3\"] = lottoAux[id].ticket.combinacion3;\n            aux[\"combinacion4\"] = lottoAux[id].ticket.combinacion4;\n            aux[\"sorteo\"] = lottoAux[id].sorteo.sorteo;\n            aux[\"subtotal\"] = parseFloat(lottoAux[id].subtotal).toFixed(2);\n            aux[\"fecha\"] = lottoAux[id].sorteo.fecha;\n            lotto.push(aux);\n        }\n        let pozoAux = this.ticketsPozo;\n        let pozo = [];\n        for (let id in pozoAux) {\n            let aux = {};\n            aux[\"combinacion1\"] = pozoAux[id].ticket.combinacion1;\n            aux[\"combinacion2\"] = pozoAux[id].ticket.combinacion2;\n            aux[\"mascota\"] = pozoAux[id].ticket.mascota;\n            aux[\"sorteo\"] = pozoAux[id].sorteo.sorteo;\n            aux[\"subtotal\"] = parseFloat(pozoAux[id].subtotal).toFixed(2);\n            aux[\"fecha\"] = pozoAux[id].sorteo.fecha;\n            pozo.push(aux);\n        }\n        let millonariaAux = this.ticketsMillonaria;\n        let millonaria = [];\n        for (let id in millonariaAux) {\n            let aux = {};\n            aux[\"combinacion1\"] = millonariaAux[id].ticket.combinacion1;\n            aux[\"combinacion2\"] = millonariaAux[id].ticket.combinacion2;\n            aux[\"fracciones\"] = millonariaAux[id].ticket.seleccionados;\n            aux[\"subtotal\"] = parseFloat(millonariaAux[id].subtotal).toFixed(2);\n            aux[\"subtotalConDesc\"] = parseFloat(millonariaAux[id].subtotalConDesc).toFixed(2);\n            aux[\"tieneDescuento\"] = millonariaAux[id].tieneDescuento;\n            aux[\"fecha\"] = millonariaAux[id].sorteo.fecha;\n            aux[\"sorteo\"] = millonariaAux[id].sorteo.sorteo;\n            millonaria.push(aux);\n        }\n        let amount = parseFloat(this.paymentService.getTotal()).toFixed(2);\n        let amountConDesc = parseFloat(this.cart.getTotalConDesc()).toFixed(2);\n        this.detalleCompra = {\n            loteria,\n            millonaria,\n            lotto,\n            pozo,\n            amount,\n            amountConDesc,\n        };\n        this.confirmacionDeCompra = true;\n    }\n    finalizarCompra() {\n        this.paymentService.finalizarCompra();\n        this.dismissCompras();\n        this.router.navigateByUrl(`/compra_tus_juegos/${this.token}`);\n    }\n    irARecarga() { }\n    async confirmarCompra() {\n        try {\n            this.isLoading = true;\n            this.loadingMessage = \"Espera mientras procesamos tu compra\";\n            let hasBalance = await this.paymentService.hasBalance(0, this.token);\n            if (hasBalance) {\n                let reservaId = this.cart.getReservaId();\n                let cartValidation = await this.cart.validarCarrito(reservaId);\n                if (cartValidation) {\n                    let response = await this.paymentService.confirmarCompra(this.token, reservaId);\n                    if (response.status) {\n                        this.codigoPromocional = response.codigoPromocional;\n                        if (response.instantanea.status) {\n                            this.dismissCompras();\n                            this.instantaneas = response.instantanea.data;\n                            this.isInstantaneas = true;\n                        }\n                        else {\n                            this.instantaneas = \"\";\n                            this.abrirFinalizar();\n                        }\n                    }\n                    else {\n                        this.cancelarCompra();\n                    }\n                }\n                this.isLoading = false;\n            }\n            else {\n                this.isLoading = false;\n                let message = \"Tu saldo es insuficiente para realizar la compra\";\n                this.recargarSaldo(message);\n            }\n        }\n        catch (e) {\n            this.isLoading = false;\n            console.log(e.message);\n            let errorMessage = e.message;\n            let errorTitle = \"Error\";\n            this.openError(errorMessage, errorTitle);\n        }\n    }\n    cancelarCompra() {\n        this.dismissCompras();\n        this.compraCancelada = true;\n    }\n    async abrirFinalizar() {\n        this.dismissCompras();\n        await this.cart.borrarCarrito();\n        this.compraFinalizada = true;\n    }\n    recargarSaldo(message) {\n        this.recargaDeSaldoMessage = message;\n        this.dismissCompras();\n        this.saldoInsuficiente = true;\n    }\n    async deleteMillonariaTicket(data) {\n        try {\n            let identificador = data.ticket.identificador;\n            let fracciones = data.ticket.seleccionados;\n            this.loadingMessage = \"Removiendo boleto del carrito\";\n            this.isLoading = true;\n            let ticket = this.ticketsMillonaria[identificador].ticket;\n            let sorteo = data.sorteo;\n            let reservaId = this.lottery.getReservaId();\n            if (fracciones.length != 0) {\n                let response = await this.lottery.eliminarBoletosDeReserva(this.token, ticket, sorteo, fracciones, 14, reservaId);\n            }\n            delete this.ticketsMillonaria[identificador];\n            await this.cart.removeFromCart(ticket, 1);\n            await this.cart.setCarritoMillonaria(this.ticketsMillonaria);\n            await this.getCarritoTickets();\n            //this.getTotal();\n            //await this.setDescuento(14);\n            this.isLoading = false;\n        }\n        catch (e) {\n            this.isLoading = false;\n            console.log(e.message);\n            let errorMessage = e.message;\n            let errorTitle = \"Error\";\n            this.openError(errorMessage, errorTitle);\n        }\n    }\n    async deleteLoteriaTicket(data) {\n        try {\n            let identificador = data.ticket.identificador;\n            let fracciones = data.ticket.seleccionados;\n            this.loadingMessage = \"Removiendo boleto del carrito\";\n            this.isLoading = true;\n            let ticket = this.ticketsLoteria[identificador].ticket;\n            let sorteo = data.sorteo;\n            let reservaId = this.lottery.getReservaId();\n            if (fracciones.length != 0) {\n                let response = await this.lottery.eliminarBoletosDeReserva(this.token, ticket, sorteo, fracciones, 1, reservaId);\n            }\n            delete this.ticketsLoteria[identificador];\n            await this.cart.setCarritoLoteria(this.ticketsLoteria);\n            await this.getCarritoTickets();\n            this.getTotal();\n            this.isLoading = false;\n        }\n        catch (e) {\n            this.isLoading = false;\n            console.log(e.message);\n            let errorMessage = e.message;\n            let errorTitle = \"Error\";\n            this.openError(errorMessage, errorTitle);\n        }\n    }\n    async deleteLottoTicket(data) {\n        try {\n            let identificador = data.ticket.identificador;\n            let fraccion = \"\";\n            this.loadingMessage = \"Removiendo boleto del carrito\";\n            this.isLoading = true;\n            let ticket = this.ticketsLotto[identificador].ticket;\n            let sorteo = data.sorteo;\n            let reservaId = this.lottery.getReservaId();\n            let response = await this.lottery.eliminarBoletosDeReserva(this.token, ticket, sorteo, fraccion, 2, reservaId);\n            delete this.ticketsLotto[identificador];\n            await this.cart.setCarritoLotto(this.ticketsLotto);\n            await this.getCarritoTickets();\n            this.getTotal();\n            this.isLoading = false;\n        }\n        catch (e) {\n            this.isLoading = false;\n            console.log(e.message);\n            let errorMessage = e.message;\n            let errorTitle = \"Error\";\n            this.openError(errorMessage, errorTitle);\n        }\n    }\n    async deleteLoteriaFraccion(data) {\n        try {\n            this.loadingMessage = \"Removiendo boleto del carrito\";\n            this.isLoading = true;\n            let identificador = data.ticket.ticket.identificador;\n            let ticket = data.ticket.ticket;\n            let sorteo = data.ticket.sorteo;\n            let fraccion = data.fraccion;\n            let reservaId = this.cart.getReservaId();\n            let response = await this.lottery.eliminarBoletosDeReserva(this.token, ticket, sorteo, [fraccion], 1, reservaId);\n            let index = this.ticketsLoteria[identificador].ticket.seleccionados.findIndex((x) => x == fraccion);\n            this.ticketsLoteria[identificador].ticket.seleccionados.splice(index, 1);\n            if (this.ticketsLoteria[identificador].ticket.seleccionados.length == 0) {\n                delete this.ticketsLoteria[identificador];\n            }\n            await this.cart.setCarritoLoteria(this.ticketsLoteria);\n            await this.getCarritoTickets();\n            this.getTotal();\n            this.isLoading = false;\n        }\n        catch (e) {\n            this.isLoading = false;\n            console.log(e.message);\n            let errorMessage = e.message;\n            let errorTitle = \"Error\";\n            this.openError(errorMessage, errorTitle);\n        }\n    }\n    async deletePozoTicket(data) {\n        try {\n            let identificador = data.ticket.identificador;\n            let fraccion = \"\";\n            this.loadingMessage = \"Removiendo boleto del carrito\";\n            this.isLoading = true;\n            let ticket = this.ticketsPozo[identificador].ticket;\n            let sorteo = data.sorteo;\n            let reservaId = this.lottery.getReservaId();\n            let response = await this.lottery.eliminarBoletosDeReserva(this.token, ticket, sorteo, fraccion, 5, reservaId);\n            delete this.ticketsPozo[identificador];\n            await this.cart.setCarritoPozo(this.ticketsPozo);\n            await this.getCarritoTickets();\n            this.getTotal();\n            this.isLoading = false;\n        }\n        catch (e) {\n            this.isLoading = false;\n            console.log(e.message);\n            let errorMessage = e.message;\n            let errorTitle = \"Error\";\n            this.openError(errorMessage, errorTitle);\n        }\n    }\n    async deleteAllTickets() {\n        try {\n            this.loadingMessage = \"Removiendo boletos del carrito\";\n            this.isLoading = true;\n            let boletosLoteria = Object.keys(this.ticketsLoteria).map((key) => {\n                return {\n                    ticket: this.ticketsLoteria[key].ticket,\n                    sorteo: this.ticketsLoteria[key].sorteo,\n                };\n            });\n            let boletosLotto = Object.keys(this.ticketsLotto).map((key) => {\n                return {\n                    ticket: this.ticketsLotto[key].ticket,\n                    sorteo: this.ticketsLotto[key].sorteo,\n                };\n            });\n            let boletosPozo = Object.keys(this.ticketsPozo).map((key) => {\n                return {\n                    ticket: this.ticketsPozo[key].ticket,\n                    sorteo: this.ticketsPozo[key].sorteo,\n                };\n            });\n            let reservaId = this.lottery.getReservaId();\n            /*       await this.lottery.eliminarTodosLosBoletosDeReserva(\n                    this.token,\n                    boletosLoteria,\n                    boletosLotto,\n                    boletosPozo,\n                    reservaId\n                  ); */\n            await this.cart.borrarCarrito();\n            await this.getCarritoTickets();\n            this.getTotal();\n            this.isLoading = false;\n        }\n        catch (e) {\n            this.isLoading = false;\n            console.log(e.message);\n            let errorMessage = e.message;\n            let errorTitle = \"Error\";\n            this.openError(errorMessage, errorTitle);\n        }\n    }\n    async getCarritoTickets() {\n        let carrito = await this.cart.buscarCarrito();\n        this.ticketsLoteria = carrito.loteria;\n        this.ticketsLotto = carrito.lotto;\n        this.ticketsPozo = carrito.pozo;\n    }\n    authError() {\n        this.openError(\"Por favor, para poder comprar tu boleto preferido, deber√°s iniciar sesi√≥n en tu cuenta\", \"Aviso\");\n    }\n    openError(msg, title) {\n        this.errorTitle = title.toUpperCase();\n        this.errorMessage = msg;\n        this.isError = true;\n    }\n    closeError() {\n        this.isError = false;\n    }\n};\nMenuBoxComponent = __decorate([\n    Component({\n        selector: 'app-menu-box',\n        templateUrl: './menu-box.component.html',\n        styleUrls: ['./menu-box.component.scss']\n    })\n], MenuBoxComponent);\nexport { MenuBoxComponent };\n"]},"metadata":{},"sourceType":"module"}