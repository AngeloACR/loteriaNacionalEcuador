{"ast":null,"code":"import _asyncToGenerator from \"/home/angeloacr/Proyectos/loteriaNacional/app/loteriaNacionalFront/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { HttpHeaders } from '@angular/common/http';\nimport { environment } from '../../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let CarritoService = /*#__PURE__*/(() => {\n  class CarritoService {\n    constructor(http) {\n      this.http = http;\n      this.total = 0;\n      this.totalConDesc = 0;\n      this.ticketsLoteria = {};\n      this.ticketsLotto = {};\n      this.ticketsPozo = {};\n      this.ticketsMillonaria = {};\n      this.ticketsCarrito = [];\n      this.reservaId = 0;\n      this.mySource = environment.source;\n    }\n\n    eliminarDescuento(element, tipoLoteria) {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        let sorteo = element.sorteo;\n\n        switch (tipoLoteria) {\n          case 1:\n            let loteria = _this.getLoteriaLocal();\n\n            for (let id in loteria) {\n              if (loteria[id].sorteo.sorteo == sorteo) {\n                loteria[id].tieneDescuento = false;\n                loteria[id].subtotalConDesc = 0;\n              }\n            }\n\n            _this.setLoteriaLocal(loteria);\n\n            break;\n\n          case 2:\n            let lotto = _this.getLottoLocal();\n\n            for (let id in lotto) {\n              if (lotto[id].sorteo.sorteo == sorteo) {\n                lotto[id].tieneDescuento = false;\n                lotto[id].subtotalConDesc = 0;\n              }\n            }\n\n            _this.setLottoLocal(lotto);\n\n            break;\n\n          case 5:\n            let pozo = _this.getPozoLocal();\n\n            for (let id in pozo) {\n              if (pozo[id].sorteo.sorteo == sorteo) {\n                pozo[id].tieneDescuento = false;\n                pozo[id].subtotalConDesc = 0;\n              }\n            }\n\n            _this.setPozoLocal(pozo);\n\n            break;\n\n          case 14:\n            let millonaria = _this.getMillonariaLocal();\n\n            for (let id in millonaria) {\n              if (millonaria[id].sorteo.sorteo == sorteo) {\n                millonaria[id].tieneDescuento = false;\n                millonaria[id].subtotalConDesc = 0;\n              }\n            }\n\n            _this.setMillonariaLocal(millonaria);\n\n            break;\n        }\n\n        yield _this.actualizarCarrito();\n      })();\n    }\n\n    calcularDescuento(descuento) {\n      var _this2 = this;\n\n      return _asyncToGenerator(function* () {\n        return;\n        let precioConDescuento = descuento.valorConDescuento;\n        let sorteo = descuento.sorteo;\n\n        switch (descuento.tipoLoteria) {\n          case '1':\n            let loteria = _this2.getLoteriaLocal();\n\n            for (let id in loteria) {\n              if (loteria[id].sorteo.sorteo == sorteo) {\n                loteria[id].tieneDescuento = true;\n                loteria[id].subtotalConDesc = loteria[id].ticket.seleccionados.length * parseFloat(precioConDescuento);\n              }\n            }\n\n            _this2.setLoteriaLocal(loteria);\n\n            break;\n\n          case '2':\n            let lotto = _this2.getLottoLocal();\n\n            for (let id in lotto) {\n              if (lotto[id].sorteo.sorteo == sorteo) {\n                lotto[id].tieneDescuento = true;\n                lotto[id].subtotalConDesc = parseFloat(precioConDescuento);\n              }\n            }\n\n            _this2.setLottoLocal(lotto);\n\n            break;\n\n          case '5':\n            let pozo = _this2.getPozoLocal();\n\n            for (let id in pozo) {\n              if (pozo[id].sorteo.sorteo == sorteo) {\n                pozo[id].tieneDescuento = true;\n                pozo[id].subtotalConDesc = parseFloat(precioConDescuento);\n              }\n            }\n\n            _this2.setPozoLocal(pozo);\n\n            break;\n\n          case '14':\n            let millonaria = _this2.getMillonariaLocal();\n\n            for (let id in millonaria) {\n              if (millonaria[id].sorteo.sorteo == sorteo) {\n                millonaria[id].tieneDescuento = true;\n                millonaria[id].subtotalConDesc = parseFloat(precioConDescuento);\n              }\n            }\n\n            _this2.setMillonariaLocal(millonaria);\n\n            break;\n        }\n\n        yield _this2.actualizarCarrito();\n      })();\n    }\n\n    contarBoletos(sorteo, tipoLoteria) {\n      var _this3 = this;\n\n      return _asyncToGenerator(function* () {\n        let aux = _this3.getCarritoLocal();\n\n        let boletos = aux.filter(item => item.sorteo.sorteo == sorteo && item.tipoLoteria == tipoLoteria);\n        let conteo;\n\n        switch (tipoLoteria) {\n          case 1:\n            conteo = boletos.reduce((total, value) => {\n              return total + value.ticket.seleccionados.length;\n            }, 0);\n            break;\n\n          case 14:\n            conteo = boletos.reduce((total, value) => {\n              return total + value.ticket.seleccionados.length;\n            }, 0);\n            break;\n\n          default:\n            conteo = boletos.length;\n            break;\n        }\n\n        return conteo;\n      })();\n    }\n\n    removeFromCart(ticket, tipoLoteria) {\n      var _this4 = this;\n\n      return _asyncToGenerator(function* () {\n        let carrito = yield _this4.getCarrito();\n        let deletedIndex = carrito.findIndex(x => x.identificador === ticket.identificador && x.tipoLoteria == tipoLoteria);\n        carrito.splice(deletedIndex, 1);\n        _this4.ticketsCarrito = carrito;\n        localStorage.setItem('seleccionadosCarrito', JSON.stringify(carrito));\n      })();\n    }\n\n    getReservaId() {\n      let reservaId = JSON.parse(localStorage.getItem('reservaId'));\n\n      if (reservaId && reservaId != '') {\n        return reservaId;\n      } else {\n        return 0;\n      }\n    }\n\n    setReservaId(id) {\n      localStorage.setItem('reservaId', JSON.stringify(id));\n    }\n\n    getCount() {\n      var _this5 = this;\n\n      return _asyncToGenerator(function* () {\n        let carrito = yield _this5.getCarrito();\n        let count = 0;\n\n        if (carrito && carrito.length) {\n          carrito.forEach(item => {\n            if (item.tipoLoteria == 1) {\n              count += item.ticket.seleccionados.length;\n            } else {\n              count += 1;\n            }\n          });\n        }\n\n        return count;\n      })();\n    }\n\n    setCarrito(ticket, tipoLoteria) {\n      var _this6 = this;\n\n      return _asyncToGenerator(function* () {\n        let carrito = _this6.getCarritoLocal();\n\n        if (!carrito) carrito = [];\n        ticket['identificador'] = ticket.ticket.identificador;\n        ticket['tipoLoteria'] = tipoLoteria;\n        let addIndex = carrito.findIndex(x => x.identificador === ticket.identificador);\n\n        if ((tipoLoteria == 1 || tipoLoteria == 14) && addIndex != -1) {\n          carrito[addIndex] = ticket;\n        } else {\n          carrito.push(ticket);\n        }\n\n        _this6.ticketsCarrito = carrito;\n        localStorage.setItem('seleccionadosCarrito', JSON.stringify(carrito));\n      })();\n    }\n\n    actualizarCarrito() {\n      var _this7 = this;\n\n      return new Promise( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (resolve, reject) {\n          let headers = new HttpHeaders();\n          headers = headers.append('Content-Type', 'application/json');\n          let address = '/reservas';\n          let endpoint = '/cache';\n          let user = JSON.parse(localStorage.getItem('userData')).playerDocument;\n          let body = {\n            loteria: _this7.getLoteriaLocal(),\n            lotto: _this7.getLottoLocal(),\n            pozo: _this7.getPozoLocal(),\n            millonaria: _this7.getMillonariaLocal(),\n            carrito: _this7.getCarritoLocal(),\n            total: _this7.getTotal(),\n            reservaId: _this7.getReservaId(),\n            user\n          };\n          endpoint = `${endpoint}/actualizarCarrito`;\n          address = _this7.mySource + address + endpoint;\n\n          _this7.http.post(address, body, {\n            headers: headers\n          }).subscribe(data => {\n            resolve('Done');\n          }, error => {\n            reject(new Error(error.error.message));\n          });\n        });\n\n        return function (_x, _x2) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    }\n\n    setCarritoLoteria(tickets) {\n      var _this8 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref2 = _asyncToGenerator(function* (resolve, reject) {\n            localStorage.setItem('seleccionadosLoteria', JSON.stringify(tickets)); //this.ticketsLoteria = tickets;\n\n            yield _this8.setTotal();\n            yield _this8.actualizarCarrito();\n            resolve('Done');\n          });\n\n          return function (_x3, _x4) {\n            return _ref2.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    setCarritoMillonaria(tickets) {\n      var _this9 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref3 = _asyncToGenerator(function* (resolve, reject) {\n            localStorage.setItem('seleccionadosMillonaria', JSON.stringify(tickets)); //this.ticketsLoteria = tickets;\n\n            yield _this9.setTotal();\n            yield _this9.actualizarCarrito();\n            resolve('Done');\n          });\n\n          return function (_x5, _x6) {\n            return _ref3.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    setCarritoLotto(tickets) {\n      var _this10 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref4 = _asyncToGenerator(function* (resolve, reject) {\n            localStorage.setItem('seleccionadosLotto', JSON.stringify(tickets)); //this.ticketsLotto = tickets;\n\n            yield _this10.setTotal();\n            yield _this10.actualizarCarrito();\n            resolve('Done');\n          });\n\n          return function (_x7, _x8) {\n            return _ref4.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    setCarritoPozo(tickets) {\n      var _this11 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref5 = _asyncToGenerator(function* (resolve, reject) {\n            localStorage.setItem('seleccionadosPozo', JSON.stringify(tickets)); //this.ticketsPozo = tickets;\n\n            yield _this11.setTotal();\n            yield _this11.actualizarCarrito();\n            resolve('Done');\n          });\n\n          return function (_x9, _x10) {\n            return _ref5.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    setCarritoLocal(data) {\n      localStorage.setItem('seleccionadosCarrito', JSON.stringify(data));\n    }\n\n    setLoteriaLocal(data) {\n      localStorage.setItem('seleccionadosLoteria', JSON.stringify(data));\n    }\n\n    setMillonariaLocal(data) {\n      localStorage.setItem('seleccionadosMillonaria', JSON.stringify(data));\n    }\n\n    setLottoLocal(data) {\n      localStorage.setItem('seleccionadosLotto', JSON.stringify(data));\n    }\n\n    setPozoLocal(data) {\n      localStorage.setItem('seleccionadosPozo', JSON.stringify(data));\n    }\n\n    getCarritoLocal() {\n      let carrito = JSON.parse(localStorage.getItem('seleccionadosCarrito'));\n\n      if (carrito && carrito.length) {\n        return carrito;\n      } else {\n        return [];\n      }\n    }\n\n    getLoteriaLocal() {\n      return JSON.parse(localStorage.getItem('seleccionadosLoteria'));\n    }\n\n    getMillonariaLocal() {\n      return JSON.parse(localStorage.getItem('seleccionadosMillonaria'));\n    }\n\n    getLottoLocal() {\n      return JSON.parse(localStorage.getItem('seleccionadosLotto'));\n    }\n\n    getPozoLocal() {\n      return JSON.parse(localStorage.getItem('seleccionadosPozo'));\n    }\n\n    buscarCarrito() {\n      var _this12 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref6 = _asyncToGenerator(function* (resolve, reject) {\n            let headers = new HttpHeaders();\n            headers = headers.append('Content-Type', 'application/json');\n            let address = '/reservas';\n            let endpoint = '/cache';\n            let user = JSON.parse(localStorage.getItem('userData')).playerDocument;\n            let body = {\n              user\n            };\n            endpoint = `${endpoint}/getCarrito`;\n            address = _this12.mySource + address + endpoint;\n\n            _this12.http.post(address, body, {\n              headers: headers\n            }).subscribe( /*#__PURE__*/function () {\n              var _ref7 = _asyncToGenerator(function* (data) {\n                let reservaId = _this12.getReservaId();\n\n                if (data.carrito.length == 0) {\n                  _this12.borrarCarrito();\n\n                  data.carrito = [];\n                  data.loteria = {};\n                  data.lotto = {};\n                  data.pozo = {};\n                  data.millonaria = {};\n                  data.reservaId = 0;\n                }\n\n                _this12.setCarritoLocal(data.carrito);\n\n                _this12.setLoteriaLocal(data.loteria);\n\n                _this12.setLottoLocal(data.lotto);\n\n                _this12.setMillonariaLocal(data.millonaria);\n\n                _this12.setPozoLocal(data.pozo);\n\n                _this12.setReservaId(data.reservaId);\n\n                yield _this12.setTotal();\n                resolve(data);\n              });\n\n              return function (_x13) {\n                return _ref7.apply(this, arguments);\n              };\n            }(), error => {\n              reject(new Error(error.error.message));\n            });\n          });\n\n          return function (_x11, _x12) {\n            return _ref6.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    validarCarrito(reservaId) {\n      var _this13 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref8 = _asyncToGenerator(function* (resolve, reject) {\n            let headers = new HttpHeaders();\n            headers = headers.append('Content-Type', 'application/json');\n            let address = '/reservas';\n            let endpoint = '/cache';\n            let user = JSON.parse(localStorage.getItem('userData')).playerDocument;\n            let token = JSON.parse(localStorage.getItem('userData')).lotteryToken;\n            let body = {\n              user,\n              token,\n              reservaId\n            };\n            endpoint = `${endpoint}/validar`;\n            address = _this13.mySource + address + endpoint;\n\n            _this13.http.post(address, body, {\n              headers: headers\n            }).subscribe(data => {\n              /*           if (!data.status) {\n                reject(new Error(data.message));\n              }\n              */\n              resolve(data);\n            }, error => {\n              reject(new Error(error.error.message));\n            });\n          });\n\n          return function (_x14, _x15) {\n            return _ref8.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    getCarrito() {\n      var _this14 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref9 = _asyncToGenerator(function* (resolve, reject) {\n            let carritoDB = yield _this14.buscarCarrito();\n            resolve(carritoDB.carrito); //resolve(JSON.parse(localStorage.getItem(\"seleccionadosCarrito\")));\n          });\n\n          return function (_x16, _x17) {\n            return _ref9.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    getCarritoLoteria() {\n      var _this15 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref10 = _asyncToGenerator(function* (resolve, reject) {\n            let carritoDB = yield _this15.buscarCarrito();\n            resolve(carritoDB.loteria); //resolve(JSON.parse(localStorage.getItem(\"seleccionadosLoteria\")));\n          });\n\n          return function (_x18, _x19) {\n            return _ref10.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    getCarritoLotto() {\n      var _this16 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref11 = _asyncToGenerator(function* (resolve, reject) {\n            let carritoDB = yield _this16.buscarCarrito();\n            resolve(carritoDB.lotto); //resolve(JSON.parse(localStorage.getItem(\"seleccionadosLotto\")));\n          });\n\n          return function (_x20, _x21) {\n            return _ref11.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    getCarritoPozo() {\n      var _this17 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref12 = _asyncToGenerator(function* (resolve, reject) {\n            let carritoDB = yield _this17.buscarCarrito();\n            resolve(carritoDB.pozo); //resolve(JSON.parse(localStorage.getItem(\"seleccionadosPozo\")));\n          });\n\n          return function (_x22, _x23) {\n            return _ref12.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    getCarritoMillonaria() {\n      var _this18 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref13 = _asyncToGenerator(function* (resolve, reject) {\n            let carritoDB = yield _this18.buscarCarrito();\n            resolve(carritoDB.millonaria); //resolve(JSON.parse(localStorage.getItem(\"seleccionadosPozo\")));\n          });\n\n          return function (_x24, _x25) {\n            return _ref13.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    borrarCarrito() {\n      var _this19 = this;\n\n      return _asyncToGenerator(function* () {\n        _this19.ticketsCarrito = [];\n        _this19.ticketsLoteria = {};\n        _this19.ticketsLotto = {};\n        _this19.ticketsPozo = {};\n        _this19.ticketsMillonaria = {};\n        _this19.reservaId = 0;\n        _this19.total = 0;\n        localStorage.removeItem('seleccionadosLoteria');\n        localStorage.removeItem('seleccionadosLotto');\n        localStorage.removeItem('seleccionadosPozo');\n        localStorage.removeItem('seleccionadosCarrito');\n        localStorage.removeItem('seleccionadosMillonaria');\n        localStorage.removeItem('reservaId');\n        localStorage.removeItem('total');\n        localStorage.removeItem('totalConDesc');\n        return new Promise( /*#__PURE__*/function () {\n          var _ref14 = _asyncToGenerator(function* (resolve, reject) {\n            let headers = new HttpHeaders();\n            headers = headers.append('Content-Type', 'application/json');\n            let address = '/reservas';\n            let endpoint = '/cache';\n            let user = JSON.parse(localStorage.getItem('userData')).playerDocument;\n            let body = {\n              user\n            };\n            endpoint = `${endpoint}/borrarCarrito`;\n            address = _this19.mySource + address + endpoint;\n\n            _this19.http.post(address, body, {\n              headers: headers\n            }).subscribe(data => {\n              resolve('Done');\n            }, error => {\n              reject(new Error(error.error.message));\n            });\n          });\n\n          return function (_x26, _x27) {\n            return _ref14.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    setTotalConDesc() {\n      var _this20 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref15 = _asyncToGenerator(function* (resolve, reject) {\n            //await this.buscarCarrito();\n            let loteriaAux = _this20.getLoteriaLocal();\n\n            let lottoAux = _this20.getLottoLocal();\n\n            let pozoAux = _this20.getPozoLocal();\n\n            let millonariaAux = _this20.getMillonariaLocal();\n\n            let loteriaConDesc = 0;\n\n            for (let id in loteriaAux) {\n              if (loteriaAux[id].tieneDescuento) {\n                loteriaConDesc += parseFloat(loteriaAux[id].subtotalConDesc);\n              } else {\n                loteriaConDesc += parseFloat(loteriaAux[id].subtotal);\n              }\n            }\n\n            let lottoConDesc = 0;\n\n            for (let id in lottoAux) {\n              if (lottoAux[id].tieneDescuento) {\n                lottoConDesc += parseFloat(lottoAux[id].subtotalConDesc);\n              } else {\n                lottoConDesc += parseFloat(lottoAux[id].subtotal);\n              }\n            }\n\n            let pozoConDesc = 0;\n\n            for (let id in pozoAux) {\n              if (pozoAux[id].tieneDescuento) {\n                pozoConDesc += parseFloat(pozoAux[id].subtotalConDesc);\n              } else {\n                pozoConDesc += parseFloat(pozoAux[id].subtotal);\n              }\n            }\n\n            let millonariaConDesc = 0;\n\n            for (let id in millonariaAux) {\n              if (millonariaAux[id].tieneDescuento) {\n                millonariaConDesc += parseFloat(millonariaAux[id].subtotalConDesc);\n              } else {\n                millonariaConDesc += parseFloat(millonariaAux[id].subtotal);\n              }\n            }\n\n            let auxConDesc = loteriaConDesc + lottoConDesc + pozoConDesc + millonariaConDesc;\n            _this20.totalConDesc = auxConDesc;\n            localStorage.setItem('totalConDesc', JSON.stringify(auxConDesc));\n            resolve('Done');\n          });\n\n          return function (_x28, _x29) {\n            return _ref15.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    setTotal() {\n      var _this21 = this;\n\n      return _asyncToGenerator(function* () {\n        return new Promise( /*#__PURE__*/function () {\n          var _ref16 = _asyncToGenerator(function* (resolve, reject) {\n            //await this.buscarCarrito();\n            let loteriaAux = _this21.getLoteriaLocal();\n\n            let lottoAux = _this21.getLottoLocal();\n\n            let pozoAux = _this21.getPozoLocal();\n\n            let millonariaAux = _this21.getMillonariaLocal();\n\n            let loteria = 0;\n\n            for (let id in loteriaAux) {\n              loteria += parseFloat(loteriaAux[id].subtotal);\n            }\n\n            let lotto = 0;\n\n            for (let id in lottoAux) {\n              lotto += parseFloat(lottoAux[id].subtotal);\n            }\n\n            let pozo = 0;\n\n            for (let id in pozoAux) {\n              pozo += parseFloat(pozoAux[id].subtotal);\n            }\n\n            let millonaria = 0;\n\n            for (let id in millonariaAux) {\n              millonaria += parseFloat(millonariaAux[id].subtotal);\n            }\n\n            let aux = loteria + lotto + pozo + millonaria;\n            _this21.total = aux;\n            localStorage.setItem('total', JSON.stringify(aux));\n            resolve('Done');\n          });\n\n          return function (_x30, _x31) {\n            return _ref16.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n\n    getTotal() {\n      //return this.total;\n      let total = JSON.parse(localStorage.getItem('total'));\n\n      if (total) {\n        return total;\n      } else {\n        return 0;\n      }\n    }\n\n    getTotalConDesc() {\n      //return this.total;\n      let total = JSON.parse(localStorage.getItem('totalConDesc'));\n\n      if (total) {\n        return total;\n      } else {\n        return 0;\n      }\n    }\n\n  }\n\n  CarritoService.ɵfac = function CarritoService_Factory(t) {\n    return new (t || CarritoService)(i0.ɵɵinject(i1.HttpClient));\n  };\n\n  CarritoService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: CarritoService,\n    factory: CarritoService.ɵfac,\n    providedIn: 'root'\n  });\n  return CarritoService;\n})();","map":null,"metadata":{},"sourceType":"module"}